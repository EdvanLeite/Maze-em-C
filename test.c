#include <stdio.h>
#include <sys/time.h>
#include <stdlib.h>
#include <unistd.h>

#define RESET   "\x1b[0m"     // Resetar formatação (ANSI)
#define RED     "\x1b[41m"    // Fundo vermelho (ANSI)
#define BLUE    "\x1b[44m"    // Fundo azul (ANSI)

#define LARGURA 70
#define ALTURA  40

void start_timer(struct timeval *start_time) {
    gettimeofday(start_time, NULL);
}

void stop_timer(struct timeval *end_time) {
    gettimeofday(end_time, NULL);
}

double elapsed_time(struct timeval start_time, struct timeval end_time) {
    long seconds = end_time.tv_sec - start_time.tv_sec;
    long useconds = end_time.tv_usec - start_time.tv_usec;
    double elapsed = seconds + useconds / 1000000.0;
    return elapsed;
}

void imprimirFinal(char fim[ALTURA][LARGURA], double tempo) {
    system("cls"); // Limpar a tela (para Windows)
    int minutes = (int) tempo / 60;
    int seconds = (int) tempo % 60;
    int k=0;
    char time_str[5];
    sprintf(time_str, "%02d:%02d", minutes, seconds);

    for (int i = 0; i < ALTURA; i++) {
        for (int j = 0; j < LARGURA; j++) {
            if (fim[i][j] == '=') {
                printf(BLUE "  " RESET); // Blue for '='
            } else if (fim[i][j] == '~') {
                printf(RED "  " RESET); // Red for '~'
            }
            else if (fim[i][j] == '-') {
                printf(RED "  " RESET); // Red for '~'
            } else if (fim[i][j] == '#') {
                printf(RED " %c" RESET, time_str[k]); // Red for time digits
                k++;
            } else {
                printf(RED " %c" RESET, fim[i][j]); // Red for other characters
            } 
        }
        printf("\n");
    }
}

int main() {
    struct timeval start_time, end_time;
    double elapsed;

    // Inicia o cronômetro
    printf("Iniciando o cronômetro...\n");
    start_timer(&start_time);

    // Espera por 5 segundos (simula alguma operação)
    sleep(5);

    // Para o cronômetro
    stop_timer(&end_time);

    // Calcula e imprime o tempo decorrido
    elapsed = elapsed_time(start_time, end_time);
    printf("Tempo decorrido: %.6f segundos\n", elapsed);

    char final[ALTURA][LARGURA]= {
        "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~==============================PARABENS=============================~",
        "~===================================================================~",
        "~================O ULTIMO LABIRINTO FOI FINALIZADO==================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===============================TIMER===============================~",
        "~==============================-------==============================~",
        "~==============================-#####-==============================~",
        "~==============================-------==============================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~===================================================================~",
        "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~",
    };

    imprimirFinal(final, elapsed);

    return 0;
}